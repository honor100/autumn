# The MySQL server


[mysqld]
# basic settings
port                                = 3306
user                                = mysql
server-id                           = 95273306
datadir                             = /data/mysql3306
pid-file                            = /data/mysql3307/mysql.pid
socket                              = /data/mysql3307/mysql.sock
tmpdir                              = /tmp
max_allowed_packet                  = 64M
default-time-zone        	        = system
character-set-server     	        = utf8
#sql_mode = "STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER"
sql_mode                            = "STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_AUTO_CREATE_USER"
autocommit 			                = 1
explicit_defaults_for_timestamp     = 1
lower_case_table_names              = 1
transaction-isolation 		        = REPEATABLE-READ
ft_min_word_len			            = 2
event_scheduler 		            = 1
read_only                           = 0

# table cache performance settings
table_open_cache_instances          = 8
table_open_cache                    = 4096
table_definition_cache              = 4096
open-files-limit         	        = 65535

# session memory settings
read_buffer_size                    = 16M
read_rnd_buffer_size                = 32M
sort_buffer_size                    = 32M
join_buffer_size                    = 32M
max_tmp_tables                      = 256
tmp_table_size                      = 128M
max_heap_table_size                 = 128M
thread_cache_size                   = 64


# query cache settings
query_cache_size                    = 256M
query_cache_limit                   = 8M
query_cache_type                    = 1

# connection settings
back_log                	        = 1800
interactive_timeout                 = 1800
wait_timeout                        = 1800
lock_wait_timeout                   = 1800
skip-name-resolve                   = 1
max_user_connections                = 4000
max_connections                     = 5000
max_connect_errors                  = 99999999


# innodb settings
default-storage-engine              = InnoDB
innodb_data_file_path		        = ibdata1:200M:autoextend
innodb_buffer_pool_size             = 1G
innodb_buffer_pool_instances        = 8
innodb_buffer_pool_dump_pct 	    = 40
innodb_page_cleaners 		        = 8
innodb_log_buffer_size              = 8M
innodb_log_files_in_group	        = 3
innodb_log_file_size		        = 1G
innodb_flush_log_at_trx_commit      = 1
innodb_undo_tablespaces		        = 3
innodb_undo_logs		            = 128
innodb_undo_log_truncate 	        = 1
innodb_max_undo_log_size 	        = 2G
innodb_purge_rseg_truncate_frequency = 128
innodb_purge_threads                = 4
innodb_max_dirty_pages_pct          = 25
innodb_lock_wait_timeout            = 20
innodb_flush_method                 = O_DIRECT
innodb_support_xa                   = 1
innodb_io_capacity                  = 500
innodb_io_capacity_max              = 4000
innodb_open_files                   = 4096
innodb_file_per_table               = 1
innodb_autoinc_lock_mode            = 2
innodb_read_io_threads              = 8
innodb_write_io_threads             = 8
innodb_stats_persistent_sample_pages = 64
innodb_thread_concurrency	        = 64
innodb_use_native_aio  	            = 1
innodb_flush_neighbors		        = 1
innodb_numa_interleave        	    = 1
innodb_strict_mode                  = 1
innodb_large_prefix 		        = 1
innodb_print_all_deadlocks 	        = 1
innodb_sort_buffer_size             = 64M
innodb_online_alter_log_max_size    = 1G

# tokuDB settings
#default-storage-engine              = TokuDB
tokudb_row_format 		            = tokudb_fast
tokudb_cache_size                   = 128M
tokudb_directio                     = 1
tokudb_read_block_size              = 128K
tokudb_read_buf_size                = 128K
tokudb_commit_sync                  = OFF
tokudb_fsync_log_period             = 1000


# log settings
log-error                           = error.log
slow-query-log                      = 1
long_query_time                     = 1
log_queries_not_using_indexes 	    = 1
log_slow_admin_statements           = 1
log_slow_slave_statements           = 1
log_throttle_queries_not_using_indexes = 10
min_examined_row_limit 	    	    = 100
slow-query-log-file                 = slow.log
general-log                         = 0
general_log_file                    = mysql.log
binlog-rows-query-log-events 	    = 1
log-bin-trust-function-creators     = 1
log-slave-updates                   = 1

# replication settings
gtid_mode 			                = on
enforce_gtid_consistency 	        = 1
log-bin                             = mysql-bin
binlog_format                       = ROW
binlog_cache_size        	        = 1M
max_binlog_size			            = 512M
sync_binlog                         = 1
expire_logs_days                    = 10
relay-log                           = relay-bin
max_relay_log_size                  = 512M
relay_log_purge                     = 1
relay_log_recovery                  = 1
slave_net_timeout                   = 60
skip-slave-start                    = 1
slave_skip_errors 	        	    = ddl_exist_errors
slave-rows-search-algorithms 	    = 'INDEX_SCAN,HASH_SCAN'

# Enhanced Multi_Threaded Slave
master_info_repository              = TABLE
relay-log-info-repository           = TABLE
slave-parallel-type                 = LOGICAL_CLOCK
slave-parallel-workers              = 8
slave_preserve_commit_order         = 1
slave_transaction_retries           = 128

# semi sync replication settings
plugin_load = "audit_log=audit_log.so;rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so"
rpl_semi_sync_master_enabled 	    = 1
rpl_semi_sync_slave_enabled 	    = 1
rpl_semi_sync_master_timeout 	    = 3000
rpl_semi_sync_master_wait_point     = AFTER_SYNC
rpl_semi_sync_master_wait_for_slave_count = 1


# audit
#plugin-load                        = "audit_log=audit_log.so"
audit_log_file                      = audit.log
audit_log_format                    = JSON
audit_log_buffer_size               = 16M
audit_log_strategy                  = PERFORMANCE
audit_log_rotate_on_size            = 1G
audit_log_rotations                 = 10
audit_log_policy                    = "NONE"

# Percona config
thread_handling                     = pool-of-threads
thread_pool_oversubscribe           = 10
thread_pool_stall_limit             = 10
#extra_port                          = 13306

# other change settings #
binlog_gtid_simple_recovery         = 1
log_timestamps                      = system
show_compatibility_56               = on

[mysqld_safe]
thp-setting			                = never

[mysql]
prompt 				                = [\\u@\\h][\\d]>\\_
no-auto-rehash
default-character-set               = utf8
connect-timeout                     = 3

[mysqldump]
quick
max_allowed_packet                  = 64M